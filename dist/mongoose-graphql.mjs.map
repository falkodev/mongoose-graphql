{"version":3,"file":null,"sources":["../lib/getType.js","../lib/getTypeObjects.js","../lib/getTypeTree.js","../lib/index.js"],"sourcesContent":["/* eslint-disable import/prefer-default-export */\n\nconst getType = (typeObject) => {\n  let typeString = `type ${typeObject.type} {\\n`;\n\n  Object.keys(typeObject.properties)\n    .sort()\n    .forEach((key) => {\n      typeString += `  ${key}: ${typeObject.properties[key]}\\n`;\n    });\n\n  typeString += '}';\n\n  return typeString;\n};\n\nexport default getType;\n","import { forOwn, upperFirst } from 'lodash';\nimport pluralize from 'pluralize';\n\nconst getTypeObjects = (name, typeTree) => {\n  let typeObjects = [];\n\n  const currentType = {\n    type: name,\n    properties: {},\n  };\n\n  forOwn(typeTree, (value, key) => {\n    const isArray = Array.isArray(value);\n    const typeValue = isArray ? value[0] : value;\n\n    let type;\n    if (typeof typeValue === 'object') {\n      const childTypeName = pluralize(`${name}${upperFirst(key)}`, 1);\n\n      // Add the child type objects to the front\n      const childTypeObjects = getTypeObjects(childTypeName, typeValue);\n      typeObjects = childTypeObjects.concat(typeObjects);\n\n      type = childTypeName;\n    } else {\n      type = typeValue;\n    }\n\n    if (isArray) {\n      type = `[${type}]`;\n    }\n\n    currentType.properties[key] = type;\n  });\n\n\n  if (Object.keys(currentType.properties).length > 0) {\n    typeObjects.push(currentType);\n  }\n\n  return typeObjects;\n};\n\nexport default getTypeObjects;\n","/* eslint-disable no-use-before-define */\nimport { forOwn } from 'lodash';\n\nconst setDescendant = (tree, key, value) => {\n  let parentTree = tree;\n\n  // Make sure there is an object for each of the ancestors\n  // Ex. 'location.address.street1'' -> { location: { address: {} } }\n  const splitPath = key.split('.');\n  for (let i = 0; i < splitPath.length - 1; i += 1) {\n    const ancestor = splitPath[i];\n    parentTree[ancestor] = parentTree[ancestor] || {};\n    parentTree = parentTree[ancestor];\n  }\n\n  const property = splitPath[splitPath.length - 1];\n  parentTree[property] = value;\n};\n\nconst instanceToType = (instance) => {\n  switch (instance) {\n    case 'Boolean':\n      return 'Boolean';\n    case 'ObjectID':\n    case 'String':\n      return 'String';\n    case 'Date':\n    case 'Number':\n      return 'Float';\n    default:\n      throw new Error(`${instance} not implemented yet in instanceToType`);\n  }\n};\n\nconst arrayToTree = (path) => {\n  if (path.caster && path.caster.instance) {\n    return [instanceToType(path.caster.instance)];\n  } else if (path.casterConstructor) {\n    return [getTypeTree(path.casterConstructor.schema.paths)];\n  }\n\n  throw new Error(`${path} is not a supported path`);\n};\n\nconst getTypeTree = (schemaPaths) => {\n  const typeTree = {};\n\n  forOwn(schemaPaths, (path, key) => {\n    if (/__/.test(key)) {\n      return;\n    }\n\n    let value;\n\n    if (path.instance === 'Array') {\n      value = arrayToTree(path);\n    } else if (path.instance === 'Embedded') {\n      value = getTypeTree(path.caster.schema.paths);\n    } else {\n      value = instanceToType(path.instance);\n    }\n\n    setDescendant(typeTree, key, value);\n  });\n\n  return typeTree;\n};\n\nexport default getTypeTree;\n","/* eslint-disable import/prefer-default-export */\nimport { find, forOwn } from 'lodash';\n\nimport getType from './getType';\nimport getTypeObjects from './getTypeObjects';\nimport getTypeTree from './getTypeTree';\n\nexport const modelToType = (model, options = {}) => {\n  const schema = model.schema;\n  const typeTree = getTypeTree(schema.paths);\n\n  const typeObjects = getTypeObjects(options.name || model.modelName, typeTree);\n  if (options.extend) {\n    forOwn(options.extend, (extension, type) => {\n      const typeObject = find(typeObjects, t => t.type === type);\n      Object.assign(typeObject.properties, extension);\n    });\n  }\n\n  const typeStrings = typeObjects.map(getType);\n  return typeStrings.join('\\n');\n};\n"],"names":["getType","typeObject","typeString","type","keys","properties","sort","forEach","key","getTypeObjects","name","typeTree","typeObjects","currentType","value","isArray","Array","typeValue","childTypeName","pluralize","upperFirst","childTypeObjects","concat","Object","length","push","setDescendant","tree","parentTree","splitPath","split","i","ancestor","property","instanceToType","instance","Error","arrayToTree","path","caster","casterConstructor","getTypeTree","schema","paths","schemaPaths","test","modelToType","model","options","modelName","extend","extension","find","t","assign","typeStrings","map","join"],"mappings":"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"}